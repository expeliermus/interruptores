<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/png" href="./assets/img/favicon.png">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>
        Panel de control Habitaciones
    </title>
    <meta content='width=device-width, initial-scale=1.0, shrink-to-fit=no' name='viewport' />
    <link rel="stylesheet" type="text/css" href="./assets/css/fonts.css" />
    <link rel="stylesheet" type="text/css" href="./assets/css/fontawesome.css" />
    <link href="./assets/css/material-kit.css?v=2.0.7" rel="stylesheet" />
    <style>
    </style>
</head>

<body>

    <div class="main main-raised" style="margin-top: 10px">
        <div class="container">
            <div class="section text-center" style="color:black;padding-top: 2px;padding-bottom: 2px;">
                <table class="table" id="cuerpo">
                </table>
            </div>
        </div>
    </div>
    <div class="modal fade" id="Modalcontroles" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered " role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>enviar al dispositivo solo una vez</h3>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form class="form-inline" action="" method="post">
                        <input type="hidden" id="inputMAC" />
                        <div class="form-group">
                            <label for="cod1" class="bmd-label-floating">01: &nbsp;&nbsp;&nbsp;</label>
                            <input type="text" class="form-control" id="cod1" size="20%" />
                            &nbsp;&nbsp;&nbsp;&nbsp;
                            <label for="cod11" class="bmd-label-floating">11: &nbsp;&nbsp;&nbsp;</label>
                            <input type="text" class="form-control" id="cod11" size="20%" />
                        </div>
                        <div class="form-group">
                            <label for="cod2" class="bmd-label-floating">02: &nbsp;&nbsp;&nbsp;</label>
                            <input type="text" class="form-control" id="cod2" size="20%" />
                            &nbsp;&nbsp;&nbsp;&nbsp;
                            <label for="cod12" class="bmd-label-floating">12: &nbsp;&nbsp;&nbsp;</label>
                            <input type="text" class="form-control" id="cod12" size="20%" />
                        </div>
                        <div class="form-group">
                            <label for="cod3" class="bmd-label-floating">03: &nbsp;&nbsp;&nbsp;</label>
                            <input type="text" class="form-control" id="cod3" size="20%" />
                            &nbsp;&nbsp;&nbsp;&nbsp;
                            <label for="cod13" class="bmd-label-floating">13: &nbsp;&nbsp;&nbsp;</label>
                            <input type="text" class="form-control" id="cod13" size="20%" />
                        </div>
                        <div class="form-group">
                            <label for="cod4" class="bmd-label-floating">04: &nbsp;&nbsp;&nbsp;</label>
                            <input type="text" class="form-control" id="cod4" size="20%" />
                            &nbsp;&nbsp;&nbsp;&nbsp;
                            <label for="cod14" class="bmd-label-floating">14: &nbsp;&nbsp;&nbsp;</label>
                            <input type="text" class="form-control" id="cod14" size="20%" />
                        </div>
                        <div class="form-group">
                            <label for="cod5" class="bmd-label-floating">05: &nbsp;&nbsp;&nbsp;</label>
                            <input type="text" class="form-control" id="cod5" size="20%" />
                            &nbsp;&nbsp;&nbsp;&nbsp;
                            <label for="cod15" class="bmd-label-floating">15: &nbsp;&nbsp;&nbsp;</label>
                            <input type="text" class="form-control" id="cod15" size="20%" />
                        </div>
                        <div class="form-group">
                            <label for="cod6" class="bmd-label-floating">06: &nbsp;&nbsp;&nbsp;</label>
                            <input type="text" class="form-control" id="cod6" size="20%" />
                            &nbsp;&nbsp;&nbsp;&nbsp;
                            <label for="cod16" class="bmd-label-floating">16: &nbsp;&nbsp;&nbsp;</label>
                            <input type="text" class="form-control" id="cod16" size="20%" />
                        </div>
                        <div class="form-group">
                            <label for="cod7" class="bmd-label-floating">07: &nbsp;&nbsp;&nbsp;</label>
                            <input type="text" class="form-control" id="cod7" size="20%" />
                            &nbsp;&nbsp;&nbsp;&nbsp;
                            <label for="cod17" class="bmd-label-floating">17: &nbsp;&nbsp;&nbsp;</label>
                            <input type="text" class="form-control" id="cod17" size="20%" />
                        </div>
                        <div class="form-group">
                            <label for="cod8" class="bmd-label-floating">08: &nbsp;&nbsp;&nbsp;</label>
                            <input type="text" class="form-control" id="cod8" size="20%" />
                            &nbsp;&nbsp;&nbsp;&nbsp;
                            <label for="cod18" class="bmd-label-floating">18: &nbsp;&nbsp;&nbsp;</label>
                            <input type="text" class="form-control" id="cod18" size="20%" />
                        </div>
                        <div class="form-group">
                            <label for="cod9" class="bmd-label-floating">09: &nbsp;&nbsp;&nbsp;</label>
                            <input type="text" class="form-control" id="cod9" size="20%" />
                            &nbsp;&nbsp;&nbsp;&nbsp;
                            <label for="cod19" class="bmd-label-floating">19: &nbsp;&nbsp;&nbsp;</label>
                            <input type="text" class="form-control" id="cod19" size="20%" />
                        </div>
                        <div class="form-group">
                            <label for="cod10" class="bmd-label-floating">10: &nbsp;&nbsp;&nbsp;</label>
                            <input type="text" class="form-control" id="cod10" size="20%" />
                            &nbsp;&nbsp;&nbsp;&nbsp;
                            <label for="cod20" class="bmd-label-floating">20: &nbsp;&nbsp;&nbsp;</label>
                            <input type="text" class="form-control" id="cod20" size="20%" />
                        </div>
                        <span class="form-group bmd-form-group">
                            <!-- needed to match padding for floating labels -->
                            <button type="button" id="enviar" class="btn btn-primary">enviar</button>
                        </span>
                    </form>
                </div>
            </div>
        </div>

    </div>
    <!--script src="./assets/js/jquery.min.js" type="text/javascript"></script-->
    <!--script src="./assets/js/popper.js"></script-->
    <!--script src="./assets/js/bootstrap-material-design.js"></script-->
    <script type="text/javascript">
    var datosDesdeSQL = 'xyzopqdatosdesdeelserver'
    var linea = '';
    for (var caso of JSON.parse(datosDesdeSQL)) {
        linea = linea + '<tr>'
        linea = linea + '<th scope="row" style="padding-top: 20px;">'
        linea = linea + '<button type="button" onclick="tomaDatomac(this);" data-cual="'+ caso.mac +'" class="btn btn-outline-primary" data-toggle="modal" data-target="#Modalcontroles"><b>' + caso.habitacion + ' </b>&nbsp;&nbsp;&nbsp; (' + caso.mac + ')</button>'
        linea = linea + '</th></tr>'
        $("#cuerpo").append(linea);
        linea = '';
    }
    $(document).ready(function() {
        $('#enviar').attr('onClick', 'envia()');
    })


    function tomaDatomac(x) {
        //console.log($(x).data("cual"));
        $("#inputMAC").val($(x).data("cual"));
    }


    function envia() {
        $("#enviar").attr('onClick', '');
        var mac = $("#inputMAC").val();
        var datos = [];
        var pos,codigo;
        for (var t=1;t<=20;t++){
            pos=t.toString();
            if (pos.length == 1) {pos='0' +t}
            codigo=$("#cod"+t).val();
            if (codigo.length > 0){

            item = {}
            item ["pos"] = pos;
            item ["codigo"] = codigo;
            datos.push(item);
            }
        }        
        if (datos.length > 0) {

        $.ajax({
            type: "POST",
            data: {
                mac: mac,
                datos: datos
            },
            contentType: 'application/x-www-form-urlencoded',
            mimeType: 'application/x-www-form-urlencoded', //Property added in 1.5.1
            url: "http://xyzopqwebserver:xyzopqwebport/seteacontroles",
            success: function(msg) {
                var respuesta = JSON.parse(msg);
                if (respuesta[0].error == '0') {alert("correcto, no hubo errores")}
                if (respuesta[0].error != '0') {$("#enviar").attr('onClick', 'envia()');}
                if (respuesta[0].error == '1') {alert("No pudo subscribirse a controles");}
                if (respuesta[0].error == '2') {alert("No se publicó al menos uno de los codigos");}
                if (respuesta[0].error == '3') {alert("Error desconocido, tal vez se grabó y tal vez no");}
                $("#enviar").attr('onClick', 'envia()');
            },
            error: function(XMLHttpRequest, textStatus, errorThrown) {
                alert("No hay conexion, no se grabó el cambio");
                $('#enviar').attr('onClick', 'envia()');
            }
        });
        
        }
    }
    </script>
</body>

</html>