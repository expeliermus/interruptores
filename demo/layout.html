<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/png" href="assets/img/favicon-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="assets/img/favicon-160x160.png" sizes="160x160">
    <link rel="icon" type="image/png" href="assets/img/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="assets/img/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="assets/img/favicon-16x16.png" sizes="16x16">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>
        Panel de control Habitaciones
    </title>
    
    <meta name="viewport" content= "width=device-width, initial-scale=1.0,  user-scalable=yes,  shrink-to-fit=yes">
    <link rel="stylesheet" type="text/css" href="assets/css/fonts.css" />
    <link rel="stylesheet" type="text/css" href="assets/css/fontawesome.css" />
    <link href="assets/css/material-kit.css?v=2.0.7" rel="stylesheet" />
    <style type="text/css">
    .cuadrados {
        position: absolute;
        margin-top: 0px;
        margin-bottom: 0px;
    }

    #graficos {
        position: absolute;
        left: 5px;
        top: 5px;

        width: 1040px;
    }

    .contenido {
        font-family: "frutiger";
        opacity: 0.1;
    }


    #hh1 {
        left: 60px;
        top: 560px;
    }

    #hh2 {
        left: 60px;
        top: 380px;
    }

    #hh3 {
        left: 310px;
        top: 560px;
    }

    #hh4 {
        left: 310px;
        top: 380px;
    }

    #hh5 {
        left: 560px;
        top: 560px;
    }

    #hh6 {
        left: 560px;
        top: 380px;
    }

    #hh7 {
        left: 810px;
        top: 560px;
    }

    #hh8 {
        left: 810px;
        top: 380px;
    }

    #hh9 {
        left: 1054px;
        top: 560px;
    }

    #hh14 {
        left: 1054px;
        top: 0px;
    }

    #hh15 {
        left: 1300px;
        top: 0px;
    }

    #hh12 {
        left: 1054px;
        top: 170px;
    }

    #hh13 {
        left: 1300px;
        top: 170px;
    }

    #hh10 {
        left: 1054px;
        top: 340px;
    }

    #hh11 {
        left: 1300px;
        top: 340px;
    }
    </style>
</head>

<body class="index-page sidebar-collapse">
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" >
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content" >
                <div class="modal-body text-center" >
                    <button  class="btn btn-success btn-lg" data-dismiss="modal" aria-label="Close" onclick="continuar();">Continuar</button>
                      
                </div>
            </div>
        </div>
    </div>
    <nav class="navbar navbar-transparent fixed-top navbar-expand-lg" color-on-scroll="100" id="sectionsNav">
        <div class="container">
            <div class="navbar-translate">
                <a class="navbar-brand"></a>
                <span id="muestraError" style="color: red"></span>
                <audio id="alerta1">
                    <source src="./assets/mp3/alerta1.mp3" muted="muted" type="audio/mpeg"></audio>
                <audio id="alerta2">
                    <source src="./assets/mp3/alerta2.mp3" muted="muted" type="audio/mpeg"></audio>
                <audio id="alerta3">
                    <source src="./assets/mp3/alerta3.mp3" muted="muted" type="audio/mpeg"></audio>
            </div>
        </div>
    </nav>
    <div class="contenido">
    <div class="section section-tabs">
        <div class="container" id="cuadradosHabitaciones">
        </div>
        <div class="container" id="alertamaxima" style="display:none;">
        </div>
        <div id="graficos">
        </div>
    </div>
    </div>
    <!--   Core JS Files   -->
    <script src="assets/js/jquery.min.js" type="text/javascript"></script>
    <script src="assets/js/popper.min.js" type="text/javascript"></script>
    <script src="assets/js/bootstrap-material-design.min.js" type="text/javascript"></script>
    <!--  Plugin for the Datepicker, full documentation here: https://github.com/Eonasdan/bootstrap-datetimepicker -->
    <!--  Plugin for the Sliders, full documentation here: http://refreshless.com/nouislider/ -->
    <!--  Google Maps Plugin    -->
    <!-- Control Center for Material Kit: parallax effects, scripts for the example pages etc -->
    <script src="assets/js/material-kit.js?v=2.0.7" type="text/javascript"></script>

    <script>
    var elem = document.documentElement;
    function openFullscreen() {
      if (elem.requestFullscreen) {
        elem.requestFullscreen();
      } else if (elem.mozRequestFullScreen) { /* Firefox */
        elem.mozRequestFullScreen();
      } else if (elem.webkitRequestFullscreen) { /* Chrome, Safari & Opera */
        elem.webkitRequestFullscreen();
      } else if (elem.msRequestFullscreen) { /* IE/Edge */
        elem.msRequestFullscreen();
      }
    }

    $('#myModal').modal('show');
    function continuar(){
        $('.contenido').css('opacity',1);
        //openFullscreen() ;
    }
    var cantAlertaMaxima = 0;
    var arrHabAlertaMaxima = [];
    var arrCamaAlertaMaxima = [];

    function disparaAlertaMaxima() {
        //alert(cual);
        $("#cuadradosHabitaciones").css("display", "none");
        $("#alertamaxima").css("display", "block");
        //cantAlertaMaxima=cantAlertaMaxima+1;
        var gridColumnas;
        var gridfilas;
        var cuadrado;
        var altocuadrado;
        switch (cantAlertaMaxima) {
            case 1:
                gridColumnas = 12;
                gridfilas = 1;
                altocuadrado = 200;
                altoletra = 120;
                break;
            case 2:
                gridColumnas = 6;
                gridfilas = 1;
                altocuadrado = 200;
                altoletra = 120;
                break;
            case 3:
                gridColumnas = 6;
                gridfilas = 2;
                altocuadrado = 100;
                altoletra = 70;
                break;
            case 4:
                gridColumnas = 6;
                gridfilas = 2;
                altocuadrado = 100;
                altoletra = 70;
                break;
            default:
                gridColumnas = 12;
                gridfilas = 1;
                altocuadrado = 250;
                altoletra = 100;
                var aux = arrHabAlertaMaxima.shift().toString();
                for (var z = 2; arrHabAlertaMaxima.length > 0; z++) {
                    aux = aux + '&nbsp;&nbsp;&nbsp;' + arrHabAlertaMaxima.shift();
                    if (z % 3 == 0) { aux = aux + '<br/>' }
                }
                arrHabAlertaMaxima = [aux];
                arrCamaAlertaMaxima = [0];
        }

        var columna = '';
        var fila = '';
        var cuadrado = '';
        var textocama = '';
        var camaAM = '';
        var habAM= '';
        for (y = 1; y <= gridfilas; y++) {
            //habrá 2 filas cuando sean  3 o 4 alertas juntas
            columna = '';
            for (x = 12; x >= gridColumnas; x = x - 6) {
                //habrá 2 columnas cuando sean 2, 3 o 4 alertas juntas
                if (arrCamaAlertaMaxima.length > 0) {
                    textocama = '';
                    camaAM=arrCamaAlertaMaxima.shift();
                    habAM=arrHabAlertaMaxima.shift();
                    //if (arrCamaAlertaMaxima[0] == 0) { textocama = '&nbsp;'; } else { textocama = 'cama: ' + camaAM; }
                    cuadrado = '<div style="height:' + altocuadrado + 'px;margin-top: 50px;margin-bottom: 50px;margin-right: 50px;margin-left: 50px;" class=" text-center card-header card-header-danger">';
                    cuadrado = cuadrado + '<h1 class="card-title" style="margin-top: ' + (altoletra - 100) * 0.2 + 'px;font-size:' + altoletra + 'px;">' + habAM + '</h1>';
                   // cuadrado = cuadrado + '<p class="category" style="margin-top: 20px;font-size:53px;">' + textocama + '</p>';
                    cuadrado = cuadrado + '</div>';
                    if(habAM == undefined) {cuadrado = "&nbsp;"}
                    columna = columna + '<div class="col-md-' + gridColumnas + '"><div class="card">' + cuadrado + '</div></div>';
                }
            }
            fila = '<div class="row">' + columna + '<div>';
            $("#alertamaxima").append(fila);
        }

    }


    var cuadrados = '';
    for (var h = 1; h <= 15; h++) {
        cuadrados = cuadrados + '<div class="cuadrados" id="hh' + h + '">';
        cuadrados = cuadrados + ' <div class="card text-center" id="Hcolor' + h + '">'
        cuadrados = cuadrados + '  <h2>' + h + '</h2>'
        cuadrados = cuadrados + '  <h3 style="margin-top: 0px;margin-bottom: 0px;" id="Htexto' + h + '">&nbsp;</h3>'
        cuadrados = cuadrados + '  <h4 style="text-align: right !important;padding-right: 20px;" id="Hantiguedad' + h + '">&nbsp;</h4>'
        cuadrados = cuadrados + ' </div>'
        cuadrados = cuadrados + '</div>'
        if (h % 6 == 0) { cuadrados = cuadrados + '' }
    }
    cuadrados = cuadrados + ''

    $("#cuadradosHabitaciones").html(cuadrados);
    $(document).ready(function() {
        //$(window) da la ventana que se ve, no la que se puede scrolear
        //var altomax = $(window).height();
        //var anchomax = $(window).width();
        //var altomax = 650;
        //var anchomax = 1360;
        var anchocuadrado = 240;
        var altocuadrado = 130;
        //console.log('altomax=' + altomax);
        //console.log('altocuadrado=' + altocuadrado);
        //console.log('anchomax=' + anchomax);
        //console.log('anchocuadrado=' + anchocuadrado);

        /*
                $("#hh1").css("left", 0 * anchocuadrado + anchocuadrado / 2).css("top", 4 * altocuadrado + altocuadrado / 2);
                $("#hh2").css("left", 0 * anchocuadrado + anchocuadrado / 2).css("top", 3 * altocuadrado + altocuadrado / 2);
                $("#hh3").css("left", 1 * anchocuadrado + anchocuadrado / 2).css("top", 4 * altocuadrado + altocuadrado / 2);
                $("#hh4").css("left", 1 * anchocuadrado + anchocuadrado / 2).css("top", 3 * altocuadrado + altocuadrado / 2);
                $("#hh5").css("left", 2 * anchocuadrado + anchocuadrado / 2).css("top", 4 * altocuadrado + altocuadrado / 2);
                $("#hh6").css("left", 2 * anchocuadrado + anchocuadrado / 2).css("top", 3 * altocuadrado + altocuadrado / 2);
                $("#hh7").css("left", 3 * anchocuadrado + anchocuadrado / 2).css("top", 4 * altocuadrado + altocuadrado / 2);
                $("#hh8").css("left", 3 * anchocuadrado + anchocuadrado / 2).css("top", 3 * altocuadrado + altocuadrado / 2);
                $("#hh9").css("left", 4 * anchocuadrado + anchocuadrado / 2).css("top", 4 * altocuadrado + altocuadrado / 2);
                $("#hh10").css("left", 4 * anchocuadrado + anchocuadrado / 2).css("top", 2 * altocuadrado + altocuadrado / 2);

                $("#hh11").css("left", 5 * anchocuadrado + anchocuadrado / 2).css("top", 2 * altocuadrado + altocuadrado / 2);
                $("#hh12").css("left", 4 * anchocuadrado + anchocuadrado / 2).css("top", 1 * altocuadrado + altocuadrado / 2);
                $("#hh13").css("left", 5 * anchocuadrado + anchocuadrado / 2).css("top", 1 * altocuadrado + altocuadrado / 2);
                $("#hh14").css("left", 4 * anchocuadrado + anchocuadrado / 2).css("top", 0 * altocuadrado + altocuadrado / 2);
                $("#hh15").css("left", 5 * anchocuadrado + anchocuadrado / 2).css("top", 0 * altocuadrado + altocuadrado / 2);
        */
        $(".cuadrados").css("width", anchocuadrado - 8).css("height", altocuadrado);

        function chequeaStatus() {
            cantAlertaMaxima = 0;
            arrHabAlertaMaxima = [];
            arrCamaAlertaMaxima = [];
            $("#alertamaxima").html('');
            $.ajax({
                type: "POST",
                data: "nada=" + 0 + "&nada2= '" + 0 + "'",
                contentType: 'application/x-www-form-urlencoded',
                mimeType: 'application/x-www-form-urlencoded', //Property added in 1.5.1
                url: "http://xyzopqwebserver:xyzopqwebport/status",
                success: function(msg) {
                    $("#muestraError").html("");
                    var respuesta = JSON.parse(msg);
                    var d = Date.now();
                    for (var caso of respuesta) {
                        var d2 = new Date(caso.ultrespuesta);
                        //console.log(caso.habitacion ,": ",caso.antiguedad);
                        if (caso.ultrespuesta == null || (d - d2) / 60000 > 5) {
                            //si resulta que el dispositivo no se reporta desde hace X minutos entonces ignoro el estado de la habitacion por obsoleto y muestro un estado de "roto"
                            $("#Hcolor" + caso.habitacion).css('background-color', 'black');
                            $("#Hcolor" + caso.habitacion).css('color', 'white');
                            $("#Htexto" + caso.habitacion).html('&nbsp;');
                            $("#Hantiguedad" + caso.habitacion).html('&nbsp;');

                        } else {
                            $("#Hcolor" + caso.habitacion).css('color', 'black');
                            if (caso.estado != 1) { $("#Hantiguedad" + caso.habitacion).html(caso.antiguedad); } else {$("#Hantiguedad" + caso.habitacion).html('&nbsp;');}
                            if (caso.estado != 4) { $("#Hcolor" + caso.habitacion).css('background-color', '#' + caso.color) }
                            // if (caso.estado == 5) { $("#Hcolor" + caso.habitacion).css('background-color', '#1597D4') }
                            // if (caso.estado == 2) { $("#Hcolor" + caso.habitacion).css('background-color', '#23EB58') } //FFFC33
                            // if (caso.estado == 3) { $("#Hcolor" + caso.habitacion).css('background-color', 'yellow') }
                            if (caso.estado == 4) {
                                $("#Hcolor" + caso.habitacion).css('background-color', '#' + caso.color);
                                cantAlertaMaxima++;
                                arrHabAlertaMaxima.push(caso.habitacion);
                                arrCamaAlertaMaxima.push(caso.cama);
                                //window.clearInterval(g_demoraprom);
                                //window.clearInterval(g_prof_race);
                                $("#graficos").html('');
                            }
                            if (caso.cama == 0 && caso.profesional == '') {
                                $("#Htexto" + caso.habitacion).html('&nbsp;');
                            } else {
                                if (caso.profesional != '') {
                                    if (caso.profesional.length > 15) {
                                        $("#Htexto" + caso.habitacion).html("<small style='color:black;'>" + caso.profesional + "</small>");
                                    } else {
                                        $("#Htexto" + caso.habitacion).html(caso.profesional);
                                    }
                                } else {
                                    $("#Htexto" + caso.habitacion).html('cama: ' + caso.cama.toString());
                                }
                            }
                        }
                    }
                    if (cantAlertaMaxima > 0) {
                        disparaAlertaMaxima();

                        if (cantAlertaMaxima == 1) { $("#alerta1").trigger("play"); }
                        if (cantAlertaMaxima == 2) { $("#alerta2").trigger("play"); }
                        if (cantAlertaMaxima > 2) { $("#alerta3").trigger("play"); }

                    } else { $("#cuadradosHabitaciones").css("display", "block"); }

                },
                error: function(XMLHttpRequest, textStatus, errorThrown) {
                    $("#muestraError").html("no está conectado a la base de datos");
                }
            });
        }

        function g_prof_race() {
            $("#graficos").load("/g_prof_race.html", function() {
                $("[aria-labelledby='id-66-title']").remove();
                setTimeout(g_demoraprom, 5 * 60000);

            });
        }

        function g_demoraprom() {
            $("#graficos").load("/g_demoraprom.html", function() {
                setTimeout(g_prof_race, 2 * 60000);
                $("[aria-labelledby='id-66-title']").remove();
                $("[aria-labelledby='id-179-title']").remove();
                $("[aria-labelledby='id-292-title']").remove();
            });
        }
        setTimeout(g_prof_race, 1100);
        setInterval(chequeaStatus, 1000);
        //chequeaStatus();

    });
    </script>
</body>

</html>